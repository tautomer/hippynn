<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Model and Loss Graphs &mdash; hippynn 0+unknown documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=e3456cac" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=c9d3d048"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Units in hippynn" href="units.html" />
    <link rel="prev" title="Databases" href="databases.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            hippynn
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">How to install hippynn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="features.html">hippynn Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts.html">hippynn Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="databases.html">Databases</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Model and Loss Graphs</a></li>
<li class="toctree-l2"><a class="reference internal" href="units.html">Units in hippynn</a></li>
<li class="toctree-l2"><a class="reference internal" href="ckernels.html">Custom Kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="settings.html">Library Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_nodes.html">Creating Custom Node Types</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_documentation/hippynn.html">hippynn API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hippynn</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">User Guide</a></li>
      <li class="breadcrumb-item active">Model and Loss Graphs</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user_guide/loss_graph.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="databases.html" class="btn btn-neutral float-left" title="Databases" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="units.html" class="btn btn-neutral float-right" title="Units in hippynn" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="model-and-loss-graphs">
<h1>Model and Loss Graphs<a class="headerlink" href="#model-and-loss-graphs" title="Link to this heading"></a></h1>
<p>The graphs in hippynn are divided into two
conceptual domains, that of the model, and that of the loss.</p>
<p>One reason for this is to cleanly separate what the model
predicts from the true values in the database.
Another reason is to support the separate evaluation of the training loss with all of
the other metrics we may wish to report about the model, in the ‘validation loss’.</p>
<p>The distinction can be explicitly made by accessing the <code class="docutils literal notranslate"><span class="pre">.pred</span></code> or <code class="docutils literal notranslate"><span class="pre">.true</span></code> attributes
of a Node. <code class="docutils literal notranslate"><span class="pre">.pred</span></code> corresponds to a predicted computation from the model. <code class="docutils literal notranslate"><span class="pre">.true</span></code> is
the corresponding value in the database. This value is found by looking at the <code class="docutils literal notranslate"><span class="pre">db_name</span></code> string.
name of the Node.</p>
<p>It is usually sufficient to begin forming a loss graph using the static method <code class="docutils literal notranslate"><span class="pre">of_node</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hippynn.graphs</span> <span class="kn">import</span> <span class="n">loss</span>
<span class="n">mae_energy</span> <span class="o">=</span> <span class="n">loss</span><span class="o">.</span><span class="n">MAELoss</span><span class="o">.</span><span class="n">of_node</span><span class="p">(</span><span class="n">molecule_energy</span><span class="p">)</span>
</pre></div>
</div>
<p>This is actually equivalent to the more verbose:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mae_energy</span> <span class="o">=</span> <span class="n">loss</span><span class="o">.</span><span class="n">MAELoss</span><span class="p">(</span><span class="n">molecule_energy</span><span class="o">.</span><span class="n">pred</span><span class="p">,</span><span class="n">molecule_energy</span><span class="o">.</span><span class="n">true</span><span class="p">)</span>
</pre></div>
</div>
<p>It is possible to manually specify computations in the loss graph, rather than the model graph.
However, this is not recommended, because in order to ensure correct statistics, validation losses
are applied to the model outputs of an entire validation subset. For example, the mean of the RMSE
of a set of batches is not equal to the RMSE of all the points in the batches viewed as a single batch.
To deal with this larger size, during validation, the model outputs are detached from autograd and accumulated
on the CPU. Then the validation loss graphs is applied to the entire set of data. This is not typically
expensive so long as the loss graph does not contain any complex operatinos. But one could
desire to do some forms of post-processing in the loss graph. For example, calculating the
per-atom energy in the loss can be accomplished as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hippynn.graphs</span> <span class="kn">import</span> <span class="n">physics</span>
<span class="n">pred_per_atom</span> <span class="o">=</span> <span class="n">physics</span><span class="o">.</span><span class="n">PerAtom</span><span class="p">(</span><span class="s2">&quot;PeratomPredicted&quot;</span><span class="p">,(</span><span class="n">molecule_energy</span><span class="o">.</span><span class="n">pred</span><span class="p">,</span><span class="n">species</span><span class="o">.</span><span class="n">true</span><span class="p">))</span>
<span class="n">true_per_atom</span> <span class="o">=</span> <span class="n">physics</span><span class="o">.</span><span class="n">PerAtom</span><span class="p">(</span><span class="s2">&quot;PeratomTrue&quot;</span><span class="p">,(</span><span class="n">molecule_energy</span><span class="o">.</span><span class="n">true</span><span class="p">,</span><span class="n">species</span><span class="o">.</span><span class="n">true</span><span class="p">))</span>
<span class="n">mae_per_atom</span> <span class="o">=</span> <span class="n">loss</span><span class="o">.</span><span class="n">MAELoss</span><span class="p">(</span><span class="n">pred_per_atom</span><span class="p">,</span><span class="n">true_per_atom</span><span class="p">)</span>
</pre></div>
</div>
<p>It is, however, perhaps simpler to pre-calculate the per atom-energy in the database,
and and make it a model output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">en_per_atom</span> <span class="o">=</span> <span class="n">physics</span><span class="o">.</span><span class="n">PerAtom</span><span class="p">(</span><span class="s2">&quot;EnPerAtom&quot;</span><span class="p">,</span><span class="n">molecule_energy</span><span class="p">,</span><span class="n">db_name</span><span class="o">=</span><span class="s1">&#39;EpA&#39;</span><span class="p">)</span>
<span class="n">mae_per_atom</span> <span class="o">=</span> <span class="n">loss</span><span class="o">.</span><span class="n">MAELoss</span><span class="o">.</span><span class="n">of_node</span><span class="p">(</span><span class="n">en_per_atom</span><span class="p">)</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="databases.html" class="btn btn-neutral float-left" title="Databases" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="units.html" class="btn btn-neutral float-right" title="Units in hippynn" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Los Alamos National Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>