

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Controller &mdash; hippynn 0+unknown documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=66b59bf7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=e3456cac" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=c9d3d048"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plotting" href="plotting.html" />
    <link rel="prev" title="Minimal Workflow" href="minimal_workflow.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            hippynn
          </a>
              <div class="version">
                0+unknown
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../what_is_hippynn.html">What is hippynn?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">How to install hippynn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Research articles using hippynn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/features.html">hippynn Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/concepts.html">hippynn Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/databases.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/loss_graph.html">Model and Loss Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/units.html">Units in hippynn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/ckernels.html">Custom Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/settings.html">Library Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/custom_nodes.html">Creating Custom Node Types</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="minimal_workflow.html">Minimal Workflow</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="predictor.html">Predictor</a></li>
<li class="toctree-l1"><a class="reference internal" href="ensembles.html">Ensembling Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="periodic.html">Periodic Boundary Conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="forces.html">Force Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="restarting.html">Restarting training</a></li>
<li class="toctree-l1"><a class="reference internal" href="ase_calculator.html">ASE Calculators</a></li>
<li class="toctree-l1"><a class="reference internal" href="mliap_unified.html">LAMMPS interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="excited_states.html">Non-Adiabiatic Excited States</a></li>
<li class="toctree-l1"><a class="reference internal" href="weighted_loss.html">Weighted/Masked Loss Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="lightning.html">Pytorch Lightning module</a></li>
<li class="toctree-l1"><a class="reference internal" href="hyperopt.html">Hyperparameter optimization with Ax and Ray</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_documentation/hippynn.html">Full API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_summary/hippynn.html">API Summary Pages</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hippynn</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Controller</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/controller.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="minimal_workflow.html" class="btn btn-neutral float-left" title="Minimal Workflow" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="plotting.html" class="btn btn-neutral float-right" title="Plotting" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="controller">
<h1>Controller<a class="headerlink" href="#controller" title="Link to this heading">ÔÉÅ</a></h1>
<p>How to define a controller for more customized control of the training process.
We assume that there is a set of <code class="docutils literal notranslate"><span class="pre">training_modules</span></code> assembled and a <code class="docutils literal notranslate"><span class="pre">database</span></code> object has been constructed.</p>
<p>The following snippet shows how to set up a controller using a custom scheduler or optimizer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">hippynn.experiment.controllers</span> <span class="kn">import</span> <span class="n">RaiseBatchSizeOnPlateau</span><span class="p">,</span><span class="n">PatienceController</span>

<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">training_modules</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span><span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>

<span class="n">scheduler</span> <span class="o">=</span>  <span class="n">RaiseBatchSizeOnPlateau</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                                     <span class="n">max_batch_size</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
                                     <span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                     <span class="n">max_epochs</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="n">controller</span> <span class="o">=</span> <span class="n">PatienceController</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
                                <span class="n">scheduler</span><span class="o">=</span><span class="n">scheduler</span><span class="p">,</span>
                                <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                <span class="n">eval_batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
                                <span class="n">max_epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                <span class="n">termination_patience</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                <span class="n">fraction_train_eval</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                <span class="n">stopping_key</span><span class="o">=</span><span class="n">early_stopping_key</span><span class="p">,</span>
                                <span class="p">)</span>

<span class="n">experiment_params</span> <span class="o">=</span> <span class="n">hippynn</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">SetupParams</span><span class="p">(</span>
    <span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The role of the controller is to govern the dynamics of training outside of the concerns
of the optimizer (how to perform parameter updates) and the scheduler (how to modify the
optimizer). The controller reports when to stop training.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="minimal_workflow.html" class="btn btn-neutral float-left" title="Minimal Workflow" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="plotting.html" class="btn btn-neutral float-right" title="Plotting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Los Alamos National Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>